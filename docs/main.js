!function(t){function e(i){if(s[i])return s[i].exports;var r=s[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var s={};e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="docs",e(e.s=14)}([function(t,e,s){"use strict";var i=s(17),r=s(7),n=s(5),o=s(2),a=s(3),c=s(22),u=s(23);const h=new a.b(new i.a,new r.b,new n.b,new o.b);e.c=h;const l=new c.a("home");e.a=l;class p{get diceImage(){return this._diceImage||(this._diceImage=this.getDiceImage())}get diceSound(){return this._diceSound||(this._diceSound=this.getDiceSound())}getDiceImage(){return new u.a(document.getElementById("dice-image"))}getDiceSound(){return document.getElementById("dice-sound")}}const d=new p;e.b=d},function(t,e,s){"use strict";function i(t){return Array.from(t).map(t=>("00"+t.toString(16)).slice(-2)).join("")}e.a=function(){return a.replace(c,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},e.b=function(t){return i(n()(Object(o.encode)(t)))},e.c=function(t){return new Promise((e,s)=>{const i=new XMLHttpRequest;i.responseType="json",i.open("GET",t),i.onload=(()=>{200===i.status?e(i.response):s(new Error(i.statusText))}),i.onerror=(()=>{s(new Error(i.statusText))}),i.send()})};var r=s(18),n=s.n(r),o=s(19);s.n(o);const a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",c=/[xy]/g},function(t,e,s){"use strict";var i=s(8),r=s(5),n=s(10),o=s(11),a=s(1);class c{constructor(...t){if(t.length>=1&&"object"==typeof t[0]){const e=t[0],s=t[1];this.uuid=String(void 0!==s?s:e.uuid||Object(a.a)()),this.profile=String(e.profile),this.inputs=new i.b(e.inputs),this.points=new r.c(e.points),this.items=Array.from(e.items||[]).map(t=>new n.a(t)),this.history=new o.a(e.history),this.visible=void 0===e.visible||Boolean(e.visible)}else{const e=t[0];this.uuid=Object(a.a)(),this.profile=e,this.inputs=new i.b,this.points=new r.c,this.items=[],this.history=new o.a,this.visible=!0}}toJSON(){return{uuid:this.uuid,profile:this.profile,inputs:this.inputs,points:this.points,items:this.items,history:this.history,visible:this.visible}}}e.a=c;class u{constructor(){this._table=Object.create(null),this._listeners=[]}contains(t){return t in this._table}get(t){return this._table[t]}list(){return Object.keys(this._table).map(t=>this._table[t])}add(t){const e=this.contains(t.uuid);this._table[t.uuid]=t,this.raiseListChangedEvent(e?"update":"add",t)}remove(t){this.get(t.uuid)===t&&(delete this._table[t.uuid],this.raiseListChangedEvent("remove",t))}import(t){if(Array.isArray(t))for(const e of t)this.add(new c(e))}refresh(t){this.get(t.uuid)===t&&this.raiseListChangedEvent("update",t)}addListener(t){this._listeners.push(t)}removeListener(t){const e=this._listeners.lastIndexOf(t);-1!==e&&this._listeners.splice(e,1)}[Symbol.iterator](){return this.list()[Symbol.iterator]()}raiseListChangedEvent(t,e){for(const s of this._listeners)s.onCharacterListChanged(t,e)}}e.b=u},function(t,e,s){"use strict";s.d(e,"a",function(){return u});var i=s(21),r=s(7),n=s(5),o=s(11);const a="cthulhu-tools-status",c=0;var u;!function(t){function e(t,e){const s=t.profiles?Array.from(t.profiles):[],i=t.attributes?Array.from(t.attributes):[],r=t.skills?Array.from(t.skills):[],n=t.characters?Array.from(t.characters):[],o=new Set(s.map(t=>t.uuid)),a=new Set(i.map(t=>t.uuid));for(const t of n){const i=e.profiles.get(t.profile);!i||i.default||o.has(i.uuid)||(s.push(i),o.add(i.uuid))}for(const t of s){const s=e.attributes.get(t.attributes);for(const t of s)t.default||a.has(t.uuid)||(i.push(t),a.add(t.uuid))}return{profiles:0!==s.length?s:void 0,attributes:0!==i.length?i:void 0,skills:0!==r.length?r:void 0,characters:0!==n.length?n:void 0}}t.validate=function(t){return"object"==typeof t&&t.format===a&&"number"==typeof t.version},t.create=function(t,s){return void 0!==s&&(t=e(t,s)),Object.assign({format:a,version:c},t)},t.resolve=e}(u||(u={}));class h{constructor(t,e,s,i){this.profiles=t,this.attributes=e,this.skills=s,this.characters=i}validateProfile(t){return t.attributes.every(t=>this.attributes.contains(t))}validateCharacter(t){return this.profiles.contains(t.profile)&&this.validateProfile(this.profiles.get(t.profile))}import(t){u.validate(t)&&(this.profiles.import(t.profiles),this.attributes.import(t.attributes),this.skills.import(t.skills),this.characters.import(t.characters))}}e.b=h;class l extends i.b{constructor(t,e){const s=t.profiles.get(e);super([new r.c(t.attributes,s?s.attributes:[]),new n.d(t.skills)])}}class p extends i.a{constructor(t,e){super([new r.a(t),new n.a(e)])}}class d{get provider(){return this.base.provider}get evaluator(){return this.base.evaluator}constructor(t,e,s=!0){const i=new l(t,e.profile),r=new p(e.inputs,e.points),n=e.history;this.base=new o.b(i,r,n),this.useCache=s}resolve(t,e){const s=this.base.resolve(t,e);return this.useCache||this.base.clear(),s}}e.c=d},function(t,e,s){"use strict";s.d(e,"b",function(){return i});var i,r=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};!function(t){t[t.Start=0]="Start",t[t.Stop=1]="Stop",t[t.Update=2]="Update"}(i||(i={}));class n{constructor(){this.interval=100,this.duration=1e3,this._current=null,this._diceSets=Object.create(null),this._listeners=[],this._rolling=!1}get current(){return this._current}get diceSet(){return null!==this._current&&this._diceSets[this._current]||null}register(t,e){this._diceSets[t]=e,this._current===t&&this.raiseDiceSetChangedEvent()}unregister(t){delete this._diceSets[t],this._current===t&&(this._current=null,this.raiseDiceSetChangedEvent())}list(){return Object.keys(this._diceSets)}get(t){return this._diceSets[t]}addListener(t){-1===this._listeners.indexOf(t)&&(this._listeners.push(t),t.onAttached&&t.onAttached(this))}removeListener(t){const e=this._listeners.indexOf(t);-1!==e&&(this._listeners.splice(e,1),t.onDetached&&t.onDetached(this))}select(t){if(!this._rolling&&t!==this._current){if(!(null===t||t in this._diceSets))throw new Error(`Unknown DiceSet: ${t}.`);this._current=t,this.raiseDiceSetChangedEvent()}}roll(){const t=this._current;if(!this._rolling&&null!==t){const e=this._diceSets[t];e&&(this._rolling=!0,this.rollAsync(e).then(()=>{this._rolling=!1},t=>{this._rolling=!1,console.error(t)}))}}rollAsync(t){return r(this,void 0,void 0,function*(){this.raiseRollEvent(i.Start);const e=Date.now()+this.duration;for(;Date.now()<e;)this.updateDiceFaces(t),this.raiseRollEvent(i.Update),yield n.sleep(this.interval);this.updateDiceFaces(t),this.raiseRollEvent(i.Update),this.raiseRollEvent(i.Stop)})}updateDiceFaces(t){for(const e of t)e.value=n.random(e)}raiseRollEvent(t){for(const e of this._listeners)e.onRoll&&e.onRoll(this,t)}raiseDiceSetChangedEvent(){for(const t of this._listeners)t.onDiceSetChanged&&t.onDiceSetChanged(this)}static random(t){return Math.floor(Math.random()*t.max)+1}static sleep(t){return r(this,void 0,void 0,function*(){yield new Promise(e=>setTimeout(e,t))})}}e.a=n},function(t,e,s){"use strict";function i(t){return Number.isFinite(t)||"string"==typeof t}var r=s(9),n=s(1),o=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};const a={locomotion:"locomotion",exploration:"exploration",knowledge:"knowledge",communication:"communication",language:"language",combat:"combat",special:"special",other:"other"};class c{constructor(t){this.id=String(t.id),this.name=String(t.name),this.category=a[t.category]||"other",this.dependencies=Array.from(t.dependencies).map(t=>String(t)),this.base=i(t.base)?t.base:0}get view(){return!1}get default(){return this._default}toJSON(){return{id:this.id,name:this.name,category:this.category,dependencies:this.dependencies,base:this.base}}markAsDefault(){return this._default=!0,this}evaluate(t,e){return("number"==typeof this.base?this.base:Object(r.a)(this.base,e))+(null!==t&&t.get(this.id)||0)}validate(t,e,s){return 0|Math.max(Math.min(s,c.MAX_VALUE),c.MIN_VALUE)}}c.MIN_VALUE=0,c.MAX_VALUE=99;class u{constructor(t){this.clear(),this.merge(t)}toJSON(){return this._data}clear(){this._data=Object.create(null)}contains(t){return t in this._data}get(t){return t in this._data?this._data[t]:0}set(t,e){0!==e?this._data[t]=e:delete this._data[t]}merge(t){t instanceof u?Object.assign(this._data,t._data):Object.assign(this._data,t)}skills(){return Object.keys(this._data)}[Symbol.iterator](){return Object.keys(this._data).map(t=>[t,this._data[t]])[Symbol.iterator]()}}e.c=u;class h{constructor(){this._table=Object.create(null)}contains(t){return t in this._table}get(t){return this._table[t]}list(){return Object.keys(this._table).map(t=>this._table[t])}add(t){const e=t.id,s=this._table[e];void 0!==s&&s.default||(this._table[e]=t)}remove(t){const e=t.id,s=this._table[e];void 0===s||s.default||delete this._table[e]}load(t,e=!1){return o(this,void 0,void 0,function*(){const s=yield Object(n.c)(t);for(const t of s){const s=new c(t);e&&s.markAsDefault(),this.add(s)}})}import(t){if(Array.isArray(t))for(const e of t)this.add(new c(e))}[Symbol.iterator](){return this.list()[Symbol.iterator]()}}e.b=h;class l{constructor(t){this.manager=t}property(t){return this.manager.get(t)}}e.d=l;class p{constructor(t){this.points=t}supports(t){return t instanceof c}evaluate(t,e){return t instanceof c?t.evaluate(this.points,e):void 0}validate(t,e,s){return t instanceof c?t.validate(this.points,e,s):s}}e.a=p},function(t,e,s){"use strict";function i(t,e,s){return 0|Math.min(Math.max(t,e),s)}s.d(e,"b",function(){return r});var r;!function(t){t[t.D6=0]="D6",t[t.D10=1]="D10",t[t.D100=2]="D100"}(r||(r={}));class n{constructor(t,e){this.type=t,this.face=e}}var o;!function(t){t.select=function(t){if(t<=0)throw new Error("'max' is too small.");if(t>100)throw new Error("'max' is too large.");if(t<=6)return new a(t);if(t<=10)return new c(t);if(t<=100)return new u(t);throw new Error("Unreachable path.")}}(o||(o={}));class a{get value(){return this._dice.face}set value(t){this._dice.face=i(t,1,this.max)}get max(){return this._max}get dices(){return[this._dice]}constructor(t){this._max=i(t,1,6),this._dice=new n(r.D6,1),this.value=1}[Symbol.iterator](){return this.dices[Symbol.iterator]()}}class c{get value(){return 0!==this._dice.face?this._dice.face:10}set value(t){this._dice.face=i(t,1,this.max)%10}get max(){return this._max}get dices(){return[this._dice]}constructor(t){this._max=i(t,1,10),this._dice=new n(r.D10,0),this.value=this.max}[Symbol.iterator](){return this.dices[Symbol.iterator]()}}class u{get value(){return(t=>0!==t?t:100)(10*this._dices[0].face+this._dices[1].face)}set value(t){(t=>{this._dices[0].face=t/10|0,this._dices[1].face=t%10})(i(t,1,this._max)%100)}get max(){return this._max}get dices(){return this._dices}constructor(t){this._max=i(t,1,100),this._dices=[new n(r.D100,0),new n(r.D10,0)],this.value=this.max}[Symbol.iterator](){return this.dices[Symbol.iterator]()}}class h{constructor(t){this.groups=t}get size(){return this.groups.length}get values(){return this.groups.map(t=>t.value)}set values(t){this.groups.forEach((e,s)=>{e.value=t[s]})}get total(){return this.groups.reduce((t,e)=>t+e.value,0)}get max(){return this.groups.reduce((t,e)=>t+e.max,0)}[Symbol.iterator](){return this.groups[Symbol.iterator]()}static create(t,e){const s=[];for(let i=0;i<t;i++)s.push(o.select(e));return new h(s)}static parse(t){if(!this.DICE_REGEX.test(t))throw new Error("Invalid expression.");const[e,s]=t.split("D"),i=parseInt(e,10),r=parseInt(s,10);return this.create(i,r)}}e.a=h,h.DICE_REGEX=/[1-9]\d*D[1-9]\d*/},function(t,e,s){"use strict";function i(t){return Number.isFinite(t)||"string"==typeof t}var r=s(8),n=s(9),o=s(1),a=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};class c{constructor(t,e=t.uuid||Object(o.a)()){this.uuid=String(e),this.id=String(t.id),this.name=String(t.name),this.dependencies=Array.from(t.dependencies).map(t=>String(t)),this.inputs=Array.from(t.inputs).map(t=>r.c.from(t)),this.expression=String(t.expression),this.view=!0===t.view,this.hidden=!0===t.hidden,this._default=!1}get default(){return this._default}toJSON(){return{type:this.type,uuid:this.uuid,id:this.id,name:this.name,dependencies:this.dependencies,inputs:this.inputs,expression:this.expression,view:this.view||void 0,hidden:this.hidden||void 0}}markAsDefault(){return this._default=!0,this}evaluate(t,e){return Object(n.a)(this.expression,e,this.evaluateInputs(t))}validate(t,e,s){return s}evaluateInputs(t){return this.inputs.reduce((e,s)=>Object.assign(e,s.evaluate(t)),{})}}class u extends c{get type(){return"integer"}get min(){return void 0!==this._min?this._min:-1/0}get max(){return void 0!==this._max?this._max:1/0}constructor(t,e){super(t,e),i(t.min)&&(this._min=t.min),i(t.max)&&(this._max=t.max)}toJSON(){return Object.assign(super.toJSON(),{min:this._min,max:this._max})}evaluate(t,e){return 0|super.evaluate(t,e)}validate(t,e,s){let i;const r=()=>i||(i=this.evaluateInputs(t)),o="number"==typeof this.min?this.min:Object(n.a)(this.min,e,r()),a="number"==typeof this.max?this.max:Object(n.a)(this.max,e,r());return 0|Math.max(Math.min(s,a),o)}}class h extends c{get type(){return"number"}get min(){return void 0!==this._min?this._min:-1/0}get max(){return void 0!==this._max?this._max:1/0}constructor(t,e){super(t,e),i(t.min)&&(this._min=t.min),i(t.max)&&(this._max=t.max)}toJSON(){return Object.assign(super.toJSON(),{min:this._min,max:this._max})}evaluate(t,e){return Number(super.evaluate(t,e))}validate(t,e,s){let i;const r=()=>i||(i=this.evaluateInputs(t)),o="number"==typeof this.min?this.min:Object(n.a)(this.min,e,r()),a="number"==typeof this.max?this.max:Object(n.a)(this.max,e,r());return Math.max(Math.min(s,a),o)}}class l extends c{get type(){return"text"}constructor(t,e){super(t,e)}toJSON(){return super.toJSON()}evaluate(t,e){return String(super.evaluate(t,e))}validate(t,e,s){return String(s)}}var p;!function(t){t.from=function(t){switch(t.type){case"integer":return new u(t);case"number":return new h(t);case"text":return new l(t);default:throw new Error("Invalid attribute type.")}}}(p||(p={}));class d{constructor(){this._table=Object.create(null)}contains(t){return t in this._table}get(t){return Array.isArray(t)?t.map(t=>this._table[t]).filter(t=>void 0!==t):this._table[t]}list(){return Object.keys(this._table).map(t=>this._table[t])}add(t){const e=t.uuid,s=this._table[e];void 0!==s&&s.default||(this._table[e]=t)}remove(t){const e=t.uuid,s=this._table[e];void 0===s||s.default||delete this._table[e]}load(t,e=!1){return a(this,void 0,void 0,function*(){const s=yield Object(o.c)(t);for(const t of s){const s=p.from(t);e&&s.markAsDefault(),this.add(s)}})}import(t){if(Array.isArray(t))for(const e of t)this.add(p.from(e))}[Symbol.iterator](){return this.list()[Symbol.iterator]()}}e.b=d;class f{constructor(t,e){this.manager=t,this._table=Object.create(null);for(const s of e){const e=t.get(s);e&&(this._table[e.id]=s)}}property(t){const e=this._table[t];return void 0!==e?this.manager.get(e):void 0}}e.c=f;class m{constructor(t){this.inputs=t}supports(t){return t instanceof c}evaluate(t,e){return t instanceof c?t.evaluate(this.getInputData(t),e):void 0}validate(t,e,s){return t instanceof c?t.validate(this.getInputData(t),e,s):s}getInputData(t){return this.inputs.get(t.id)||new r.a}}e.a=m},function(t,e,s){"use strict";s.d(e,"c",function(){return a});class i{constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];this.name=String(e.name)}else{const e=t[0];this.name=e}}toJSON(){return{type:this.type,name:this.name}}}class r extends i{get type(){return"dice"}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];super(e),this.count=Number(e.count),this.max=Number(e.max)}else{const e=t[0],s=t[1],i=t[2];super(e),this.count=s,this.max=i}}toJSON(){return Object.assign(super.toJSON(),{count:this.count,max:this.max})}evaluate(t){const e=null!==t&&t.get(this)||Array(this.count).fill(0),s=e.reduce((t,e,s)=>Object.assign(t,{[this.name+s.toString(10)]:Number(e)}),{}),i=e.reduce((t,e)=>t+Number(e),0);return Object.assign(s,{[this.name]:i})}}class n extends i{get type(){return"number"}get min(){return void 0!==this._min?this._min:-1/0}get max(){return void 0!==this._max?this._max:1/0}get step(){return void 0!==this._step?this._step:1}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];super(e),Number.isFinite(e.min)&&(this._min=e.min),Number.isFinite(e.max)&&(this._max=e.max),Number.isFinite(e.step)&&(this._step=e.step)}else{const e=t[0],s=t[1],i=t[2],r=t[3];super(e),Number.isFinite(s)&&(this._min=s),Number.isFinite(i)&&(this._max=i),Number.isFinite(r)&&(this._step=r)}}toJSON(){return Object.assign(super.toJSON(),{min:this._min,max:this._max,step:this._step})}evaluate(t){return{[this.name]:Number(null!==t&&t.get(this)||0)}}}class o extends i{get type(){return"text"}constructor(...t){super(1===t.length&&"object"==typeof t[0]?t[0]:t[0])}toJSON(){return super.toJSON()}evaluate(t){return{[this.name]:String(null!==t&&t.get(this)||"")}}}var a;!function(t){t.from=function(t){switch(t.type){case"dice":return new r(t);case"number":return new n(t);case"text":return new o(t);default:throw new Error("Invalid input type.")}}}(a||(a={}));class c{constructor(t){this.clear(),this.merge(t)}toJSON(){return this._data}clear(){this._data=Object.create(null)}contains(t){return t in this._data}get(t){return this.getByName(t.name)}set(t,e){this.setByName(t.name,e)}getByName(t){return this._data[t]}setByName(t,e){void 0!==e?this._data[t]=e:delete this._data[t]}merge(t){t instanceof c?Object.assign(this._data,t._data):Object.assign(this._data,t)}}e.a=c;class u{constructor(t){this.clear(),this.merge(t)}toJSON(){return this._data}clear(){this._data=Object.create(null)}contains(t){return t in this._data}get(t){return this._data[t]}getInput(t,e){return this.contains(t)?this._data[t].get(e):void 0}set(t,e,s=!1){s||!this.contains(t)?this._data[t]=new c(e):this._data[t].merge(e)}setInput(t,e,s){(this.contains(t)?this._data[t]:this._data[t]=new c).set(e,s)}merge(t){if(t instanceof u)for(const e of Object.keys(t._data))this._data[e]=new c(t._data[e]);else if(void 0!==t)for(const e of Object.keys(t))this._data[e]=new c(t[e])}}e.b=u},function(t,e,s){"use strict";e.a=function(t,e,s){const i=(new r).parse(t),n=Object.create(null);for(const t of i.variables())void 0!==s&&Object.prototype.hasOwnProperty.call(s,t)?n[t]=s[t]:n[t]=e.resolve(t);return i.evaluate(n)};var i=s(20);s.n(i);class r extends i.Parser{constructor(){super(),this.customize()}customize(){this.unaryOps={"-":t=>-t,"+":t=>+t,"!":t=>!t},this.functions={abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc,random:Math.random,min:Math.min,max:Math.max},this.consts={true:!0,false:!1}}}},function(t,e,s){"use strict";class i{constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];this.name=String(e.name),this.description=void 0!==e.description?String(e.description):""}else{const e=t[0],s=t[1];this.name=e,this.description=void 0!==s?s:""}}toJSON(){return{name:this.name,description:this.description||void 0}}}e.a=i},function(t,e,s){"use strict";var i=s(1);class r{constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];this.parent="string"==typeof e.parent?e.parent:null,this.target=String(e.target),this.message=void 0!==e.message?String(e.message):""}else{const e=t[0],s=t[1],i=t[2];this.parent=e,this.target=s,this.message=void 0!==i?i:""}}get repr(){return`${this.parent}@${this.target} "${this.message}"`}get hash(){return this._hash||(this._hash=Object(i.b)(this.repr))}toJSON(){return{type:this.type,parent:this.parent,target:this.target,message:this.message||void 0}}toString(){return`${this.hash}: ${this.repr}`}}class n extends r{get type(){return"set<number>"}get repr(){return`${this.type} ${this.value} # ${super.repr}`}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];super(e),this.value=Number(e.value)}else{const e=t[0],s=t[1],i=t[2];super(e,s,t[3]),this.value=i}}toJSON(){return Object.assign(super.toJSON(),{value:this.value})}apply(t){return this.value}}class o extends r{get type(){return"set<text>"}get repr(){return`${this.type} ${this.value} # ${super.repr}`}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];super(e),this.value=String(e.value)}else{const e=t[0],s=t[1],i=t[2];super(e,s,t[3]),this.value=i}}toJSON(){return Object.assign(super.toJSON(),{value:this.value})}apply(t){return this.value}}class a extends r{get type(){return"add<number>"}get repr(){return`${this.type} ${this.value} # ${super.repr}`}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];super(e),this.value=Number(e.value)}else{const e=t[0],s=t[1],i=t[2];super(e,s,t[3]),this.value=i}}toJSON(){return Object.assign(super.toJSON(),{value:this.value})}apply(t){return Number(t)+this.value}}var c;!function(t){t.from=function(t){switch(t.type){case"set<number>":return new n(t);case"set<text>":return new o(t);case"add<number>":return new a(t);default:throw new Error("Invalid opearation type.")}}}(c||(c={}));class u{get head(){return this._head}set head(t){this._head=null!==t&&t in this._table?t:null}get current(){return null!==this._head?this._table[this._head]:null}get operations(){return this._operations}constructor(t){void 0!==t?(this._head=t.head,this._operations=Array.from(t.operations).map(t=>c.from(t))):(this._head=null,this._operations=[]),this._table=this.makeTable(),this._tree=this.makeTree(),this.validate()}toJSON(){return{head:this._head,operations:this._operations}}contains(t){return t in this._table}get(t){return this._table[t]}add(t,e){const s=t.hash,i=t.parent;this.contains(s)||null!==i&&!this.contains(i)||(this._operations.push(t),this._table[s]=t,null!==i&&(this._tree[i]||(this._tree[i]=[])).push(s),!0===e&&(this._head=s))}remove(t,e){this.contains(t.hash)&&(!0===e?this.prune(t.hash):this.erase(t.hash))}[Symbol.iterator](){return this._operations[Symbol.iterator]()}makeTable(){const t=Object.create(null);for(const e of this._operations)t[e.hash]=e;return t}makeTree(){const t=Object.create(null);for(const e of this._operations){const s=e.parent;null!==s&&(t[s]||(t[s]=[])).push(e.hash)}return t}validate(){const t=this._operations.filter(t=>null===t.parent),e=Object.assign(Object.create(null),...t.map(t=>this.reachable(t.hash)));this._operations.some(t=>!e[t.hash])&&(this._operations=this._operations.filter(t=>e[t.hash]),this._table=this.makeTable(),this._tree=this.makeTree()),null===this._head||this._head in this._table||(this.head=null)}traverse(t,e){const s=[t];for(;0!==s.length;){const t=s.pop();if(!e(t)){const e=this._tree[t];e&&s.push(...e)}}}reachable(t){const e=Object.create(null);return this.traverse(t,t=>{const s=!1===e[t];return s||(e[t]=!e[t]),s}),e}prune(t){const e=this.reachable(t);for(;null!==this._head&&this._head in e;)this._head=this._table[this._head].parent;this._operations=this._operations.filter(t=>!(t.hash in e));for(const t of Object.keys(e))delete this._table[t],delete this._tree[t]}erase(t){const e=this._table[t],s=Object.create(null);null!==e.parent&&(s[e.parent]=this._table[e.parent]),this.traverse(t,i=>{if(i!==t){const r=this._table[i],n=r.parent!==t?r.parent:e.parent,o=null!==n?s[n].hash:null,a=c.from(Object.assign(r.toJSON(),{parent:o}));s[i]=a}}),this._head===t&&(this._head=e.parent||null),null!==this._head&&this._head in s&&(this._head=s[this._head].hash),this._operations=this._operations.map(t=>t.hash in s?s[t.hash]:t),this._operations.splice(this._operations.findIndex(e=>e.hash===t),1),this._table=this.makeTable(),this._tree=this.makeTree()}}e.a=u;class h{constructor(t,e,s){this.provider=t,this.evaluator=e,this.history=s,this.clear()}resolve(t,e=this.history.head){const s=null!==e?e:"@initial",i=this._cache[s]||(this._cache[s]=Object.create(null));if(!(t in i)){i[t]=void 0;const s=this.provider.property(t);if(s)if(null===e||s.view)i[t]=this.evaluateOn(s,e);else{const s=this.history.get(e);if(s){const e=this.resolve(t,s.parent),r=s.target===t?s.apply(e):e;i[t]=r}}}return i[t]}clear(){this._cache=Object.create(null)}evaluateOn(t,e){if(this.evaluator.supports(t)){const s=new h.SubResolver(this,e),i=this.evaluator.evaluate(t,s);return this.evaluator.validate(t,s,i)}}}e.b=h,h.SubResolver=class{constructor(t,e){this.parent=t,this.hash=e}get provider(){return this.parent.provider}get evaluator(){return this.parent.evaluator}resolve(t){return this.parent.resolve(t,this.hash)}}},function(t,e,s){"use strict";var i=s(4);class r{constructor(t,e,s,i){this.view=t,this.image=e,this.group=s,this.dice=i,this._map=new Map}clear(){this._map.clear(),r.clearChildren(this.view)}onAttached(t){this.initDices(t)}onDetached(t){this.clear()}onRoll(t,e){if(e===i.b.Update){const e=t.diceSet;e&&this.refresh(e)}}onDiceSetChanged(t){this.initDices(t)}initDices(t){this.clear();const e=t.diceSet;e&&(this.makeDices(e),this.refresh(e))}makeDices(t){for(const e of t){const t=r.createElement(this.view,"div",this.group);for(const s of e){const e=r.createElement(t,"canvas",this.dice);this._map.set(s,e)}}}refresh(t){for(const e of t)for(const t of e){const e=this._map.get(t);null!=e&&this.image.blit(e,t.type,t.face)}}static createElement(t,e,s){const i=document.createElement(e);return s&&i.classList.add(s),t.appendChild(i)}static clearChildren(t){for(;t.lastChild;)t.removeChild(t.lastChild)}}e.a=r},,function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(15),r=s(16),n=s(24),o=s(25),a=s(27);document.addEventListener("DOMContentLoaded",()=>{Object(i.a)(),Object(r.a)(),Object(n.a)(),Object(o.a)(),Object(a.a)()})},function(t,e,s){"use strict";e.a=function(){void 0===NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){Array.prototype.forEach.call(this,t,e)})}},function(t,e,s){"use strict";function i(){const t=Array.from(document.querySelectorAll("[data-page]"));o.a.addListener(new class{onEnter(e){for(const s of t)s.dataset.page===e&&s.classList.add("selected")}onExit(e){for(const s of t)s.dataset.page===e&&s.classList.remove("selected")}})}function r(){const t=Array.from(document.querySelectorAll("[data-nav]"));for(const e of t)e.addEventListener("click",()=>o.a.toPage(e.dataset.nav))}function n(){const t=Array.from(document.querySelectorAll(".page > .overlay"));for(const e of t){const t=()=>{const t=e.parentElement;Array.from(e.children).some(t=>"none"!==window.getComputedStyle(t).display)?t.classList.add("overlaid"):t.classList.remove("overlaid")};new MutationObserver(e=>{for(const s of e){const e=s.target;e instanceof HTMLElement&&e.classList.contains("dialog")&&t()}}).observe(e,{attributes:!0,attributeFilter:["class"],subtree:!0})}}var o=s(0);e.a=function(){i(),r(),n()}},function(t,e,s){"use strict";var i=s(1),r=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};class n{get initial(){return void 0!==this._initial?this._initial:this.min}get min(){return void 0!==this._min?this._min:0}get max(){return void 0!==this._max?this._max:1/0}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];void 0!==e.initial&&(this._initial=Number(e.initial)),void 0!==e.min&&(this._min=Number(e.min)),void 0!==e.max&&(this._max=Number(e.max))}else{const e=t[0],s=t[1],i=t[2];this._initial=e,this._min=s,this._max=i}}toJSON(){return{initial:this._initial,min:this._min,max:this._max}}}class o{get initial(){return void 0!==this._initial?this._initial:this.min}get min(){return void 0!==this._min?this._min:0}get max(){return void 0!==this._max?this._max:1/0}constructor(...t){if(1===t.length&&"object"==typeof t[0]){const e=t[0];void 0!==e.initial&&(this._initial=Number(e.initial)),void 0!==e.min&&(this._min=Number(e.min)),void 0!==e.max&&(this._max=Number(e.max))}else{const e=t[0],s=t[1],i=t[2];this._initial=e,this._min=s,this._max=i}}toJSON(){return{initial:this._initial,min:this._min,max:this._max}}}class a{get default(){return this._default}constructor(t,e=t.uuid||Object(i.a)(),s=t.version||0){this.uuid=String(e),this.version=Number(s),this.name=String(t.name),this.attributes=Array.from(t.attributes).map(t=>String(t)),this.skillSlots=new n(t.skillSlots),this.itemSlots=new o(t.itemSlots),this._default=!1}toJSON(){return{uuid:this.uuid,version:this.version,name:this.name,attributes:this.attributes,skillSlots:this.skillSlots,itemSlots:this.itemSlots}}markAsDefault(){return this._default=!0,this}}class c{constructor(){this._table=Object.create(null)}contains(t){return t in this._table}get(t){return this._table[t]}list(){return Object.keys(this._table).map(t=>this._table[t])}add(t){const e=t.uuid,s=this._table[e];void 0!==s&&s.default||(this._table[e]=t)}remove(t){const e=t.uuid,s=this._table[e];void 0===s||s.default||delete this._table[e]}load(t,e=!1){return r(this,void 0,void 0,function*(){const s=yield Object(i.c)(t);for(const t of s){const s=new a(t);e&&s.markAsDefault(),this.add(s)}})}import(t){if(Array.isArray(t))for(const e of t)this.add(new a(e))}[Symbol.iterator](){return this.list()[Symbol.iterator]()}}e.a=c},function(t,e,s){var i;!function(e,r){var n={};r(n);var o=n.default;for(var a in n)o[a]=n[a];"object"==typeof t&&"object"==typeof t.exports?t.exports=o:void 0!==(i=function(){return o}.call(n,s,n,t))&&(t.exports=i)}(0,function(t){"use strict";function e(t,e,s,r,n){for(var o,a,c,u,h,l,p,d,f,m,v,g,y;n>=64;){for(o=e[0],a=e[1],c=e[2],u=e[3],h=e[4],l=e[5],p=e[6],d=e[7],m=0;m<16;m++)v=r+4*m,t[m]=(255&s[v])<<24|(255&s[v+1])<<16|(255&s[v+2])<<8|255&s[v+3];for(m=16;m<64;m++)g=((f=t[m-2])>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,y=((f=t[m-15])>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,t[m]=(g+t[m-7]|0)+(y+t[m-16]|0);for(m=0;m<64;m++)g=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&l^~h&p)|0)+(d+(i[m]+t[m]|0)|0)|0,y=((o>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10))+(o&a^o&c^a&c)|0,d=p,p=l,l=h,h=u+g|0,u=c,c=a,a=o,o=g+y|0;e[0]+=o,e[1]+=a,e[2]+=c,e[3]+=u,e[4]+=h,e[5]+=l,e[6]+=p,e[7]+=d,r+=64,n-=64}return r}function s(t){var e=(new r).update(t),s=e.digest();return e.clean(),s}t.digestLength=32,t.blockSize=64;var i=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),r=function(){function s(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return s.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},s.prototype.clean=function(){for(t=0;t<this.buffer.length;t++)this.buffer[t]=0;for(var t=0;t<this.temp.length;t++)this.temp[t]=0;this.reset()},s.prototype.update=function(t,s){if(void 0===s&&(s=t.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var i=0;if(this.bytesHashed+=s,this.bufferLength>0){for(;this.bufferLength<64&&s>0;)this.buffer[this.bufferLength++]=t[i++],s--;64===this.bufferLength&&(e(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(s>=64&&(i=e(this.temp,this.state,t,i,s),s%=64);s>0;)this.buffer[this.bufferLength++]=t[i++],s--;return this},s.prototype.finish=function(t){if(!this.finished){var s=this.bytesHashed,i=this.bufferLength,r=s/536870912|0,n=s<<3,o=s%64<56?64:128;this.buffer[i]=128;for(a=i+1;a<o-8;a++)this.buffer[a]=0;this.buffer[o-8]=r>>>24&255,this.buffer[o-7]=r>>>16&255,this.buffer[o-6]=r>>>8&255,this.buffer[o-5]=r>>>0&255,this.buffer[o-4]=n>>>24&255,this.buffer[o-3]=n>>>16&255,this.buffer[o-2]=n>>>8&255,this.buffer[o-1]=n>>>0&255,e(this.temp,this.state,this.buffer,0,o),this.finished=!0}for(var a=0;a<8;a++)t[4*a+0]=this.state[a]>>>24&255,t[4*a+1]=this.state[a]>>>16&255,t[4*a+2]=this.state[a]>>>8&255,t[4*a+3]=this.state[a]>>>0&255;return this},s.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},s.prototype._saveState=function(t){for(var e=0;e<this.state.length;e++)t[e]=this.state[e]},s.prototype._restoreState=function(t,e){for(var s=0;s<this.state.length;s++)this.state[s]=t[s];this.bytesHashed=e,this.finished=!1,this.bufferLength=0},s}();t.Hash=r;var n=function(){function t(t){this.inner=new r,this.outer=new r,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var e=new Uint8Array(this.blockSize);if(t.length>this.blockSize)(new r).update(t).finish(e).clean();else for(s=0;s<t.length;s++)e[s]=t[s];for(s=0;s<e.length;s++)e[s]^=54;this.inner.update(e);for(s=0;s<e.length;s++)e[s]^=106;this.outer.update(e),this.istate=new Uint32Array(this.digestLength/4),this.ostate=new Uint32Array(this.digestLength/4),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var s=0;s<e.length;s++)e[s]=0}return t.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},t.prototype.clean=function(){for(var t=0;t<this.istate.length;t++)this.ostate[t]=this.istate[t]=0;this.inner.clean(),this.outer.clean()},t.prototype.update=function(t){return this.inner.update(t),this},t.prototype.finish=function(t){return this.outer.finished?this.outer.finish(t):(this.inner.finish(t),this.outer.update(t,this.digestLength).finish(t)),this},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t}();t.HMAC=n,t.hash=s,t.__esModule=!0,t.default=s,t.hmac=function(t,e){var s=new n(t).update(e),i=s.digest();return s.clean(),i},t.pbkdf2=function(t,e,s,i){for(var r=new n(t),o=r.digestLength,a=new Uint8Array(4),c=new Uint8Array(o),u=new Uint8Array(o),h=new Uint8Array(i),l=0;l*o<i;l++){var p=l+1;for(a[0]=p>>>24&255,a[1]=p>>>16&255,a[2]=p>>>8&255,a[3]=p>>>0&255,r.reset(),r.update(e),r.update(a),r.finish(u),f=0;f<o;f++)c[f]=u[f];for(f=2;f<=s;f++){r.reset(),r.update(u).finish(u);for(var d=0;d<o;d++)c[d]^=u[d]}for(var f=0;f<o&&l*o+f<i;f++)h[l*o+f]=c[f]}for(l=0;l<o;l++)c[l]=u[l]=0;for(l=0;l<4;l++)a[l]=0;return r.clean(),h}})},function(t,e,s){"use strict";function i(t){for(var e=0,s=0;s<t.length;++s){var i=t.charCodeAt(s);if(i<128)e+=1;else if(i<2048)e+=2;else if(i<55296)e+=3;else{if(!(i<=57343))throw new Error("utf8: invalid source string");if(s>=t.length-1)throw new Error("utf8: invalid source string");s++,e+=4}}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.encode=function(t){for(var e=new Uint8Array(i(t)),s=0,r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e[s++]=n:n<2048?(e[s++]=192|n>>6,e[s++]=128|63&n):n<55296?(e[s++]=224|n>>12,e[s++]=128|n>>6&63,e[s++]=128|63&n):(r++,n=(1023&n)<<10,n|=1023&t.charCodeAt(r),n+=65536,e[s++]=240|n>>18,e[s++]=128|n>>12&63,e[s++]=128|n>>6&63,e[s++]=128|63&n)}return e},e.encodedLength=i,e.decode=function(t){for(var e=[],s=0;s<t.length;){var i=t[s++];if(128&i)if(i<224){if(s>=t.length)throw new Error("utf8: invalid source encoding");i=(31&i)<<6|63&(r=t[s++])}else if(i<240){if(s>=t.length-1)throw new Error("utf8: invalid source encoding");i=(15&i)<<12|(63&(r=t[s++]))<<6|63&(n=t[s++])}else{if(s>=t.length-2)throw new Error("utf8: invalid source encoding");var r=t[s++],n=t[s++];i=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&t[s++]}i<65536?e.push(i):(i-=65536,e.push(55296|i>>10),e.push(56320|1023&i))}return String.fromCharCode.apply(null,e)}},function(t,e,s){!function(e,s){t.exports=s()}(0,function(){"use strict";function t(t,e){this.type=t,this.value=void 0!==e&&null!==e?e:0}function e(e){return new t(K,e)}function s(e){return new t(Q,e)}function i(e){return new t(Z,e)}function r(e,s,i,n,o){for(var a,c,u,h,l=[],p=[],d=0;d<e.length;d++){var f=e[d],m=f.type;if(m===Y)l.push(f);else if(m===tt&&o.hasOwnProperty(f.value))f=new t(Y,o[f.value]),l.push(f);else if(m===Q&&l.length>1)c=l.pop(),a=l.pop(),h=i[f.value],f=new t(Y,h(a.value,c.value)),l.push(f);else if(m===Z&&l.length>2)u=l.pop(),c=l.pop(),a=l.pop(),"?"===f.value?l.push(a.value?c.value:u.value):(h=n[f.value],f=new t(Y,h(a.value,c.value,u.value)),l.push(f));else if(m===K&&l.length>0)a=l.pop(),h=s[f.value],f=new t(Y,h(a.value)),l.push(f);else if(m===st){for(;l.length>0;)p.push(l.shift());p.push(new t(st,r(f.value,s,i,n,o)))}else if(m===it&&l.length>0)a=l.pop(),l.push(new t(Y,a.value[f.value]));else{for(;l.length>0;)p.push(l.shift());p.push(f)}}for(;l.length>0;)p.push(l.shift());return p}function n(r,o,a){for(var c=[],u=0;u<r.length;u++){var h=r[u],l=h.type;if(l===tt&&h.value===o)for(var p=0;p<a.tokens.length;p++){var d,f=a.tokens[p];d=f.type===K?e(f.value):f.type===Q?s(f.value):f.type===Z?i(f.value):new t(f.type,f.value),c.push(d)}else l===st?c.push(new t(st,n(h.value,o,a))):c.push(h)}return c}function o(t,e,s){for(var i,r,n,a,c=[],u=0;u<t.length;u++){var h=t[u],l=h.type;if(l===Y)c.push(h.value);else if(l===Q)r=c.pop(),i=c.pop(),a=e.binaryOps[h.value],c.push(a(i,r));else if(l===Z)n=c.pop(),r=c.pop(),i=c.pop(),"?"===h.value?c.push(o(i?r:n,e,s)):(a=e.ternaryOps[h.value],c.push(a(i,r,n)));else if(l===tt)if(h.value in e.functions)c.push(e.functions[h.value]);else{var p=s[h.value];if(void 0===p)throw new Error("undefined variable: "+h.value);c.push(p)}else if(l===K)i=c.pop(),a=e.unaryOps[h.value],c.push(a(i));else if(l===et){for(var d=h.value,f=[];d-- >0;)f.unshift(c.pop());if(!(a=c.pop()).apply||!a.call)throw new Error(a+" is not a function");c.push(a.apply(void 0,f))}else if(l===st)c.push(h.value);else{if(l!==it)throw new Error("invalid Expression");i=c.pop(),c.push(i[h.value])}}if(c.length>1)throw new Error("invalid Expression (parity)");return c[0]}function a(t,e){for(var s,i,r,n,o=[],u=0;u<t.length;u++){var h=t[u],l=h.type;if(l===Y)"number"==typeof h.value&&h.value<0?o.push("("+h.value+")"):o.push(c(h.value));else if(l===Q)i=o.pop(),s=o.pop(),n=h.value,e?"^"===n?o.push("Math.pow("+s+", "+i+")"):"and"===n?o.push("(!!"+s+" && !!"+i+")"):"or"===n?o.push("(!!"+s+" || !!"+i+")"):"||"===n?o.push("(String("+s+") + String("+i+"))"):"=="===n?o.push("("+s+" === "+i+")"):"!="===n?o.push("("+s+" !== "+i+")"):o.push("("+s+" "+n+" "+i+")"):o.push("("+s+" "+n+" "+i+")");else if(l===Z){if(r=o.pop(),i=o.pop(),s=o.pop(),"?"!==(n=h.value))throw new Error("invalid Expression");o.push("("+s+" ? "+i+" : "+r+")")}else if(l===tt)o.push(h.value);else if(l===K)s=o.pop(),"-"===(n=h.value)||"+"===n?o.push("("+n+s+")"):e?"not"===n?o.push("(!"+s+")"):"!"===n?o.push("fac("+s+")"):o.push(n+"("+s+")"):"!"===n?o.push("("+s+"!)"):o.push("("+n+" "+s+")");else if(l===et){for(var p=h.value,d=[];p-- >0;)d.unshift(o.pop());n=o.pop(),o.push(n+"("+d.join(", ")+")")}else if(l===it)s=o.pop(),o.push(s+"."+h.value);else{if(l!==st)throw new Error("invalid Expression");o.push("("+a(h.value,e)+")")}}if(o.length>1)throw new Error("invalid Expression (parity)");return String(o[0])}function c(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function u(t,e){for(var s=0;s<t.length;s++)if(t[s]===e)return!0;return!1}function h(t,e,s){for(var i=!!(s=s||{}).withMembers,r=null,n=0;n<t.length;n++){var o=t[n];o.type!==tt||u(e,o.value)?o.type===it&&i&&null!==r?r+="."+o.value:o.type===st?h(o.value,e,s):null!==r&&(u(e,r)||e.push(r),r=null):i?null!==r?(u(e,r)||e.push(r),r=o.value):r=o.value:e.push(o.value)}null===r||u(e,r)||e.push(r)}function l(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}function p(t,e,s){this.type=t,this.value=e,this.index=s}function d(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options}function f(t){return ot.hasOwnProperty(t)?ot[t]:t}function m(t,e,s){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==s.allowMemberAccess}function v(t,e){return Number(t)+Number(e)}function g(t,e){return t-e}function y(t,e){return t*e}function b(t,e){return t/e}function x(t,e){return t%e}function _(t,e){return""+t+e}function w(t,e){return t===e}function S(t,e){return t!==e}function E(t,e){return t>e}function O(t,e){return t<e}function k(t,e){return t>=e}function A(t,e){return t<=e}function L(t,e){return Boolean(t&&e)}function M(t,e){return Boolean(t||e)}function N(t,e){return u(e,t)}function C(t){return(Math.exp(t)-Math.exp(-t))/2}function q(t){return(Math.exp(t)+Math.exp(-t))/2}function j(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function T(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function I(t){return Math.log(t+Math.sqrt(t*t-1))}function D(t){return Math.log((1+t)/(1-t))/2}function P(t){return Math.log(t)*Math.LOG10E}function R(t){return-t}function U(t){return!t}function J(t){return t<0?Math.ceil(t):Math.floor(t)}function F(t){return Math.random()*(t||1)}function B(t){return z(t+1)}function $(t){return isFinite(t)&&t===Math.round(t)}function z(t){var e,s;if($(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var i=t-2,r=t-1;i>1;)r*=i,i--;return 0===r&&(r=1),r}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*z(1-t));if(t>=171.35)return 1/0;if(t>85){var n=t*t,o=n*t,a=o*t,c=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*n)-139/(51840*o)-571/(2488320*a)+163879/(209018880*c)+5246819/(75246796800*c*t))}--t,s=lt[0];for(var u=1;u<lt.length;++u)s+=lt[u]/(t+u);return e=t+ht+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*s}function H(t){return String(t).length}function G(){for(var t=0,e=0,s=0;s<arguments.length;s++){var i,r=Math.abs(arguments[s]);e<r?(t=t*(i=e/r)*i+1,e=r):t+=r>0?(i=r/e)*i:r}return e===1/0?1/0:e*Math.sqrt(t)}function X(t,e,s){return t?e:s}function V(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e))),+((t=t.toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function W(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||C,cosh:Math.cosh||q,tanh:Math.tanh||j,asinh:Math.asinh||T,acosh:Math.acosh||I,atanh:Math.atanh||D,sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||P,log10:Math.log10||P,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||J,"-":R,"+":Number,exp:Math.exp,not:U,length:H,"!":B},this.binaryOps={"+":v,"-":g,"*":y,"/":b,"%":x,"^":Math.pow,"||":_,"==":w,"!=":S,">":E,"<":O,">=":k,"<=":A,and:L,or:M,in:N},this.ternaryOps={"?":X},this.functions={random:F,fac:B,min:Math.min,max:Math.max,hypot:Math.hypot||G,pyt:Math.hypot||G,pow:Math.pow,atan2:Math.atan2,if:X,gamma:z,roundTo:V},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}var Y="INUMBER",K="IOP1",Q="IOP2",Z="IOP3",tt="IVAR",et="IFUNCALL",st="IEXPR",it="IMEMBER";t.prototype.toString=function(){switch(this.type){case Y:case K:case Q:case Z:case tt:return this.value;case et:return"CALL "+this.value;case it:return"."+this.value;default:return"Invalid Instruction"}},l.prototype.simplify=function(t){return t=t||{},new l(r(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},l.prototype.substitute=function(t,e){return e instanceof l||(e=this.parser.parse(String(e))),new l(n(this.tokens,t,e),this.parser)},l.prototype.evaluate=function(t){return t=t||{},o(this.tokens,this,t)},l.prototype.toString=function(){return a(this.tokens,!1)},l.prototype.symbols=function(t){t=t||{};var e=[];return h(this.tokens,e,t),e},l.prototype.variables=function(t){t=t||{};var e=[];h(this.tokens,e,t);var s=this.functions;return e.filter(function(t){return!(t in s)})},l.prototype.toJSFunction=function(t,e){var s=this,i=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+a(this.simplify(e).tokens,!0)+"; }");return function(){return i.apply(s,arguments)}};var rt="TOP";p.prototype.toString=function(){return this.type+": "+this.value},d.prototype.newToken=function(t,e,s){return new p(t,e,null!=s?s:this.pos)},d.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},d.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},d.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},d.prototype.isString=function(){var t=!1,e=this.pos,s=this.expression.charAt(e);if("'"===s||'"'===s)for(var i=this.expression.indexOf(s,e+1);i>=0&&this.pos<this.expression.length;){if(this.pos=i+1,"\\"!==this.expression.charAt(i-1)){var r=this.expression.substring(e+1,i);this.current=this.newToken("TSTRING",this.unescape(r),e),t=!0;break}i=this.expression.indexOf(s,i+1)}return t},d.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken("TPAREN",t),this.pos++,!0)},d.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,!0)},d.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()&&(e===this.pos||"_"!==s&&"."!==s&&(s<"0"||s>"9")))break}if(e>t){var i=this.expression.substring(t,e);if(i in this.consts)return this.current=this.newToken("TNUMBER",this.consts[i]),this.pos+=i.length,!0}return!1},d.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()&&(e===this.pos||"_"!==s&&(s<"0"||s>"9")))break}if(e>t){var i=this.expression.substring(t,e);if(this.isOperatorEnabled(i)&&(i in this.binaryOps||i in this.unaryOps||i in this.ternaryOps))return this.current=this.newToken(rt,i),this.pos+=i.length,!0}return!1},d.prototype.isName=function(){for(var t=this.pos,e=t,s=!1;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()){if(e===this.pos&&"$"===i)continue;if(e===this.pos||!s||"_"!==i&&(i<"0"||i>"9"))break}else s=!0}if(s){var r=this.expression.substring(t,e);return this.current=this.newToken("TNAME",r),this.pos+=r.length,!0}return!1},d.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var nt=/^[0-9a-f]{4}$/i;d.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var s=t.substring(0,e);e>=0;){var i=t.charAt(++e);switch(i){case"'":s+="'";break;case'"':s+='"';break;case"\\":s+="\\";break;case"/":s+="/";break;case"b":s+="\b";break;case"f":s+="\f";break;case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"u":var r=t.substring(e+1,e+5);nt.test(r)||this.parseError("Illegal escape sequence: \\u"+r),s+=String.fromCharCode(parseInt(r,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+i+'"')}++e;var n=t.indexOf("\\",e);s+=t.substring(e,n<0?t.length:n),e=n}return s},d.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},d.prototype.isRadixInteger=function(){var t=this.pos;if(t>=this.expression.length-2||"0"!==this.expression.charAt(t))return!1;++t;var e,s;if("x"===this.expression.charAt(t))e=16,s=/^[0-9a-f]$/i,++t;else{if("b"!==this.expression.charAt(t))return!1;e=2,s=/^[01]$/i,++t}for(var i=!1,r=t;t<this.expression.length;){var n=this.expression.charAt(t);if(!s.test(n))break;t++,i=!0}return i&&(this.current=this.newToken("TNUMBER",parseInt(this.expression.substring(r,t),e)),this.pos=t),i},d.prototype.isNumber=function(){for(var t,e=!1,s=this.pos,i=s,r=s,n=!1,o=!1;s<this.expression.length&&((t=this.expression.charAt(s))>="0"&&t<="9"||!n&&"."===t);)"."===t?n=!0:o=!0,s++,e=o;if(e&&(r=s),"e"===t||"E"===t){s++;for(var a=!0,c=!1;s<this.expression.length;){if(t=this.expression.charAt(s),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;c=!0,a=!1}else a=!1;s++}c||(s=r)}return e?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(i,s))),this.pos=s):this.pos=r,e},d.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(rt,e);else if(""===e||""===e)this.current=this.newToken(rt,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(rt,">="),this.pos++):this.current=this.newToken(rt,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(rt,"<="),this.pos++):this.current=this.newToken(rt,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(rt,"||"),this.pos++}else if("="===e){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(rt,"=="),this.pos++}else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(rt,"!="),this.pos++):this.current=this.newToken(rt,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)};var ot={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional"};d.prototype.isOperatorEnabled=function(t){var e=f(t),s=this.options.operators||{};return"in"===e?!!s.in:!(e in s&&!s[e])},d.prototype.getCoordinates=function(){var t,e=0,s=-1;do{e++,t=this.pos-s,s=this.expression.indexOf("\n",s+1)}while(s>=0&&s<this.pos);return{line:e,column:t}},d.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},m.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},m.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?u(e,t.value):"function"==typeof e?e(t):t.value===e)},m.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},m.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},m.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},m.prototype.expect=function(t,e){if(!this.accept(t,e)){var s=this.tokens.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: Expected "+(e||t))}},m.prototype.parseAtom=function(e){if(this.accept("TNAME"))e.push(new t(tt,this.current.value));else if(this.accept("TNUMBER"))e.push(new t(Y,this.current.value));else if(this.accept("TSTRING"))e.push(new t(Y,this.current.value));else{if(!this.accept("TPAREN","("))throw new Error("unexpected "+this.nextToken);this.parseExpression(e),this.expect("TPAREN",")")}},m.prototype.parseExpression=function(t){this.parseConditionalExpression(t)},m.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(rt,"?");){var s=[],r=[];this.parseConditionalExpression(s),this.expect(rt,":"),this.parseConditionalExpression(r),e.push(new t(st,s)),e.push(new t(st,r)),e.push(i("?"))}},m.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(rt,"or");)this.parseAndExpression(t),t.push(s("or"))},m.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(rt,"and");)this.parseComparison(t),t.push(s("and"))};var at=["==","!=","<","<=",">=",">","in"];m.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(rt,at);){var e=this.current;this.parseAddSub(t),t.push(s(e.value))}};var ct=["+","-","||"];m.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(rt,ct);){var e=this.current;this.parseTerm(t),t.push(s(e.value))}};var ut=["*","/","%"];m.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(rt,ut);){var e=this.current;this.parseFactor(t),t.push(s(e.value))}},m.prototype.parseFactor=function(t){var s=this.tokens.unaryOps;if(this.save(),this.accept(rt,function(t){return t.value in s}))if("-"!==this.current.value&&"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(t);else{var i=this.current;this.parseFactor(t),t.push(e(i.value))}else this.parseExponential(t)},m.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(rt,"^");)this.parseFactor(t),t.push(s("^"))},m.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(rt,"!");)t.push(e("!"))},m.prototype.parseFunctionCall=function(s){var i=this.tokens.unaryOps;if(this.accept(rt,function(t){return t.value in i})){var r=this.current;this.parseAtom(s),s.push(e(r.value))}else for(this.parseMemberExpression(s);this.accept("TPAREN","(");)if(this.accept("TPAREN",")"))s.push(new t(et,0));else{var n=this.parseArgumentList(s);s.push(new t(et,n))}},m.prototype.parseArgumentList=function(t){for(var e=0;!this.accept("TPAREN",")");)for(this.parseExpression(t),++e;this.accept("TCOMMA");)this.parseExpression(t),++e;return e},m.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(rt,".");){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect("TNAME"),e.push(new t(it,this.current.value))}};var ht=4.7421875,lt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];W.prototype.parse=function(t){var e=[],s=new m(this,new d(this,t),{allowMemberAccess:this.options.allowMemberAccess});return s.parseExpression(e),s.expect("TEOF","EOF"),new l(e,this)},W.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var pt=new W;return W.parse=function(t){return pt.parse(t)},W.evaluate=function(t,e){return pt.parse(t).evaluate(e)},{Parser:W,Expression:l}})},function(t,e,s){"use strict";class i{constructor(t){this.providers=Array.from(t)}property(t){for(const e of this.providers){const s=e.property(t);if(void 0!==s)return s}}}e.b=i;class r{constructor(t){this.evaluators=Array.from(t)}supports(t){return this.evaluators.some(e=>e.supports(t))}evaluate(t,e){const s=this.evaluators.find(e=>e.supports(t));return s&&s.evaluate(t,e)}validate(t,e,s){const i=this.evaluators.find(e=>e.supports(t));return i&&i.validate(t,e,s)}}e.a=r},function(t,e,s){"use strict";class i{constructor(t){this._listeners=[],this._page=t}get page(){return this._page}addListener(t){-1===this._listeners.indexOf(t)&&(this._listeners.push(t),t.onEnter&&t.onEnter(this.page))}removeListener(t){const e=this._listeners.indexOf(t);-1!==e&&(this._listeners.splice(e,1),t.onExit&&t.onExit(this.page))}toPage(t,e,s=!1){if(this._page!==t||s){for(const t of this._listeners)t.onExit&&t.onExit(this.page,this._context);this._page=t,this._context=e;for(const t of this._listeners)t.onEnter&&t.onEnter(this.page,this._context)}}}e.a=i},function(t,e,s){"use strict";var i,r=s(6),n=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};!function(t){t[t.Unloaded=0]="Unloaded",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Error=3]="Error"}(i||(i={}));class o{constructor(t){this.element=t,this._status=i.Unloaded,this._error=null,this._slices=null,this.loadAsync().catch(t=>{this._error=t})}get loading(){return this._status===i.Loading}get loaded(){return this._status===i.Loaded}get error(){return this._error}blit(t,e,s){if(this.loaded&&this._slices){const i=this._slices[e];if(i){const e=i[s];if(e){t.width=e.w,t.height=e.h;const s=t.getContext("2d");s&&(s.clearRect(0,0,t.width,t.height),s.drawImage(this.element,e.x,e.y,e.w,e.h,0,0,t.width,t.height))}}}}loadAsync(){return n(this,void 0,void 0,function*(){if(this._status===i.Unloaded){const t=this.element.dataset[o.DATA_LAYOUT];if(t){this._status=i.Loading;try{const e=yield this.requestAsync(t);this.parseJson(e)}catch(t){throw this._status=i.Error,t}this._status=i.Loaded}}})}requestAsync(t){return new Promise((e,s)=>{const i=new XMLHttpRequest;i.responseType="json",i.open("GET",t),i.onload=(()=>{200===i.status?e(i.response):s(new Error(i.statusText))}),i.onerror=(()=>{s(new Error(i.statusText))}),i.send()})}parseJson(t){const e=Object.create(null);e[r.b.D6]=t[r.b[r.b.D6]],e[r.b.D10]=t[r.b[r.b.D10]],e[r.b.D100]=t[r.b[r.b.D100]],this._slices=e}}e.a=o,o.DATA_LAYOUT="layout"},function(t,e,s){"use strict";function i(){const t=localStorage.getItem("characters"),e=t?JSON.parse(t):[];for(const t of e)a.c.characters.add(new o.a(t))}function r(){const t=a.c.characters.list(),e=JSON.stringify(t);localStorage.setItem("characters",e)}function n(){a.c.characters.addListener(new class{onCharacterListChanged(){r()}})}var o=s(2),a=s(0);e.a=function(){i(),n()}},function(t,e,s){"use strict";function i(){const t=Array.from(g.querySelectorAll(".mode-list .mode")).map(t=>[t,t.dataset.dice||"custom"]);for(const[e,s]of t)"custom"===s?e.addEventListener("click",()=>{u()}):(e.addEventListener("click",()=>{b.select(s)}),b.register(s,p.a.parse(s)));b.addListener(new class{onDiceSetChanged(){for(const[e,s]of t)b.current===s?e.classList.add("selected"):e.classList.remove("selected")}})}function r(){g.querySelector(".roll-button").addEventListener("click",()=>{b.roll()})}function n(){b.addListener(new class{onRoll(t,e){if(e===d.b.Start){const t=v.b.diceSound;t.pause(),t.currentTime=0,t.play()}}})}function o(){const t=g.querySelector(".result .dice-view");b.addListener(new f.a(t,v.b.diceImage,"dice-group","dice"))}function a(){const t=g.querySelector(".result .number-view");b.addListener(new m.a(t,"critical","fumble"))}function c(){const t=y.querySelector(".ok"),e=y.querySelector(".cancel");t.addEventListener("click",()=>{h(!1)}),e.addEventListener("click",()=>{h(!0)})}function u(){y.classList.add("open")}function h(t){y.classList.remove("open"),t||l()}function l(){const t=y.querySelector(".count"),e=y.querySelector(".max");if(t.validity.valid&&e.validity.valid){const s=parseInt(t.value,10),i=parseInt(e.value,10),r=p.a.create(s,i);b.register("custom",r),b.select("custom")}}var p=s(6),d=s(4),f=s(12),m=s(26),v=s(0);let g,y;const b=new d.a;e.a=function(){g=document.getElementById("dice"),y=document.getElementById("custom-dice-dialog"),i(),r(),n(),o(),a(),c()}},function(t,e,s){"use strict";var i,r=s(4);!function(t){t[t.Normal=0]="Normal",t[t.Critical=1]="Critical",t[t.Fumble=2]="Fumble"}(i||(i={}));class n{constructor(t,e,s){this.view=t,this.critical=e,this.fumble=s}clear(){this.view.textContent=null}onAttached(t){this.update(t)}onDetached(t){this.clear()}onRoll(t,e){e===r.b.Update&&this.update(t)}onDiceSetChanged(t){this.update(t)}update(t){const e=t.diceSet;e&&(this.view.textContent=e.total.toString(10),this.updateClass(e))}updateClass(t){const e=this.getResult(t);this.setClass(this.critical,e===i.Critical),this.setClass(this.fumble,e===i.Fumble)}getResult(t){if(1===t.size&&100===t.max){const e=t.total;if(e<=5)return i.Critical;if(e>95)return i.Fumble}return i.Normal}setClass(t,e){t&&(e?this.view.classList.add(t):this.view.classList.remove(t))}}e.a=n},function(t,e,s){"use strict";function i(){const t=d.querySelector(".characters"),e={character:t.querySelector(".character-template"),integer:t.querySelector(".integer-template"),number:t.querySelector(".number-template"),text:t.querySelector(".text-template"),skill:t.querySelector(".skill-template"),item:t.querySelector(".item-template")};h.c.characters.addListener(new class{onCharacterListChanged(s,i){r(t,e)}}),r(t,e)}function r(t,e){t.querySelectorAll(".character").forEach(t=>t.remove());for(const s of h.c.characters)if(h.c.validateCharacter(s)&&s.visible){const i=new u.c(h.c,s),r=h.c.profiles.get(s.profile),c=h.c.attributes.get(r.attributes),l=s.points,p=s.items,d=document.importNode(e.character.content,!0),f=d.querySelector(".attributes");for(const t of c)switch(t.type){case"integer":f.appendChild(n(t,i,e.integer));break;case"number":f.appendChild(n(t,i,e.number));break;case"text":f.appendChild(n(t,i,e.text))}const m=d.querySelector(".skills");for(const[t,s]of l){const s=h.c.skills.get(t);s&&m.appendChild(o(s,i,e.skill))}const v=d.querySelector(".items");for(const t of p)v.appendChild(a(t,i,e.item));t.appendChild(d)}}function n(t,e,s){const i=document.importNode(s.content,!0),r=i.querySelector(".attribute"),n=i.querySelector(".attr-name"),o=i.querySelector(".attr-value");return r.dataset.attr=t.id,n.textContent=t.name,o.textContent=e.resolve(t.id),r}function o(t,e,s){const i=document.importNode(s.content,!0),r=i.querySelector(".skill"),n=i.querySelector(".skill-name"),o=i.querySelector(".skill-score");return r.dataset.skill=t.id,n.textContent=t.name,o.textContent=e.resolve(t.id),r}function a(t,e,s){const i=document.importNode(s.content,!0),r=i.querySelector(".item"),n=i.querySelector(".item-name"),o=i.querySelector(".item-desc");return n.textContent=t.name,o.textContent=t.description,r}function c(){return Promise.all([h.c.profiles.load("./data/profiles.json",!0),h.c.attributes.load("./data/attributes.json",!0),h.c.skills.load("./data/skills.json",!0)])}var u=s(3),h=s(0),l=s(28),p=s(30);let d;e.a=function(){d=document.getElementById("status"),c().then(()=>{i(),Object(l.a)(),Object(p.a)()})}},function(t,e,s){"use strict";function i(){w.a.addListener(new class{onEnter(t){"character-management"===t&&u()}onExit(t){"character-management"===t&&(h(),o())}})}function r(){w.c.characters.addListener(new class{onCharacterListChanged(t,e){"remove"===t&&n(e.uuid,!1),"character-management"===w.a.page&&(h(),u(),a())}})}function n(t,e){e?E.add(t):E.delete(t),a()}function o(){E.clear(),a()}function a(){const t=Array.from(S.querySelectorAll(".characters .character"));for(const e of t){const t=e.querySelector(".check input"),s=e.dataset.uuid;t.checked=void 0!==s&&E.has(s)}c()}function c(){const t=S.querySelector(".characters");t.classList.remove("selected","single"),0!==E.size&&t.classList.add("selected"),1===E.size&&t.classList.add("single")}function u(){const t=S.querySelector(".characters"),e=t.querySelector(".character-template");for(const s of w.c.characters){const i=new x.c(w.c,s),r=document.importNode(e.content,!0).querySelector(".character"),o=r.querySelector(".check input"),a=r.querySelector(".name"),c=r.querySelector(".visibility");r.dataset.uuid=s.uuid,o.addEventListener("change",()=>{n(s.uuid,o.checked)}),a.textContent=i.resolve("name"),s.visible||c.classList.add("hidden"),c.addEventListener("click",()=>{s.visible=!s.visible,w.c.characters.refresh(s)}),t.appendChild(r)}}function h(){S.querySelectorAll(".characters .character").forEach(t=>t.remove())}function l(){const t=S.querySelector(".commands");p(t),d(t),f(t),m(t),v(t)}function p(t){t.querySelector(".delete").addEventListener("click",()=>{for(const t of g())w.c.characters.remove(t);o()})}function d(t){t.querySelector(".clone").addEventListener("click",()=>{for(const t of g())w.c.characters.add(new b.a(Object.assign(t.toJSON(),{uuid:void 0})));o()})}function f(t){t.querySelector(".edit").addEventListener("click",()=>{const t=y();t&&(w.a.toPage("character-edit",t),o())})}function m(t){t.querySelector(".import").addEventListener("click",()=>{Object(_.b)(".json").then(t=>Object(_.a)(t,"utf8")).then(t=>{w.c.import(JSON.parse(t))})})}function v(t){t.querySelector(".export").addEventListener("click",()=>{const t=g(),e=JSON.stringify(x.a.create({characters:t},w.c),null,4);Object(_.c)("characters.json","application/json",e)})}function g(){return Array.from(S.querySelectorAll(".characters .character")).filter(t=>null!==t.querySelector(".check :checked")).map(t=>t.dataset.uuid||"").map(t=>w.c.characters.get(t)).filter(t=>void 0!==t)}function y(){const t=g();return 1===t.length?t[0]:void 0}var b=s(2),x=s(3),_=s(29),w=s(0);let S;const E=new Set;e.a=function(){S=document.getElementById("character-management"),i(),r(),l()}},function(t,e,s){"use strict";function i(t){return t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))}e.b=function(t,e){return new Promise((s,r)=>{const n=document.createElement("input");n.type="file",n.accept=t,n.addEventListener("change",()=>{null!==n.files&&0!==n.files.length?s(e?n.files:n.files[0]):r("File(s) not selected.")}),i(n)||r(new Error("'click' event canceled."))})},e.c=function(t,e,s){const r=document.createElement("a");r.href=URL.createObjectURL(new Blob([s],{type:e})),r.download=t,i(r)},e.a=function(t,e){return new Promise((s,i)=>{const r=new FileReader;r.addEventListener("load",()=>{s(r.result)}),r.addEventListener("error",()=>{i(r.error)}),r.readAsText(t,e)})}},function(t,e,s){"use strict";function i(){N.a.addListener(new class{onEnter(t,e){"character-edit"===t&&n(e instanceof k.a?e:void 0)}onExit(t){"character-edit"===t&&r()}})}function r(){q.querySelectorAll(".attributes .attribute").forEach(t=>t.remove()),q.querySelectorAll(".skills .skill").forEach(t=>t.remove()),q.querySelectorAll(".items .item").forEach(t=>t.remove())}function n(t){(t?a(t):o()).then(t=>{j=t,c(),u(),h(),f()})}function o(){return C(this,void 0,void 0,function*(){let t;for(;!(t=N.c.profiles.list().find(t=>t.default));)yield(t=>new Promise(e=>setTimeout(e,t)))(1e3);return new k.a(t.uuid)})}function a(t){return C(this,void 0,void 0,function*(){return new k.a(t)})}function c(){const t=q.querySelector(".attributes"),e=q.querySelector(".attribute-template"),s=N.c.profiles.get(j.profile);if(s){const i=N.c.attributes.get(s.attributes);for(const s of i)if(!s.hidden){const i=document.importNode(e.content,!0),r=i.querySelector(".name"),n=i.querySelector(".value"),o=i.querySelector(".input");r.textContent=s.name,n.dataset.attribute=s.id,o.addEventListener("click",()=>{v(s)}),0===s.inputs.length&&o.classList.add("no-input"),t.appendChild(i)}}}function u(){const t=q.querySelector(".skills"),e=q.querySelector(".skill-template"),s=N.c.profiles.get(j.profile);if(s){const i=j.points.skills(),r=Math.max(s.skillSlots.initial,i.length);for(let s=0;s<r;s++){const r=document.importNode(e.content,!0),n=r.querySelector(".id"),o=r.querySelector(".points");for(const t of N.c.skills)n.options.add(new Option(t.name,t.id));s<i.length&&(n.value=i[s],o.value=j.points.get(i[s]).toString(10)),n.addEventListener("input",()=>{p(),f()}),o.addEventListener("input",()=>{p(),f()}),t.appendChild(r)}}}function h(){const t=q.querySelector(".items"),e=q.querySelector(".item-template"),s=N.c.profiles.get(j.profile);if(s){const i=Math.max(s.itemSlots.initial,j.items.length);for(let s=0;s<i;s++){const i=document.importNode(e.content,!0),r=i.querySelector(".name"),n=i.querySelector(".description");if(s<j.items.length){const t=j.items[s];r.value=t.name,n.value=t.description}r.addEventListener("input",d),n.addEventListener("input",d),t.appendChild(i)}}}function l(){const t=q.querySelector(".actions"),e=t.querySelector(".ok"),s=t.querySelector(".cancel");e.addEventListener("click",()=>{N.c.characters.add(j),N.a.toPage("character-management")}),s.addEventListener("click",()=>{N.a.toPage("character-management")})}function p(){const t=Array.from(q.querySelectorAll(".skills .skill"));j.points.clear();for(const e of t){const t=e.querySelector(".id"),s=e.querySelector(".points");if(t.validity.valid&&s.validity.valid&&""!==s.value){const e=t.value,i=parseInt(s.value,10);j.points.set(e,i)}}}function d(){const t=Array.from(q.querySelectorAll(".items .item"));j.items.splice(0);for(const e of t){const t=e.querySelector(".name"),s=e.querySelector(".description");if(t.validity.valid&&s.validity.valid&&""!==t.value){const e=t.value,i=s.value;j.items.push(new O.a(e,i))}}}function f(){const t=Array.from(q.querySelectorAll(".attributes .attribute")),e=Array.from(q.querySelectorAll(".skills .skill")),s=q.querySelector(".skills .point-stats"),i=new k.a(j);i.points.clear();const r=new A.c(N.c,j),n=new A.c(N.c,i);for(const e of t){const t=e.querySelector(".value"),s=t.dataset.attribute;void 0!==s&&(t.textContent=r.resolve(s,null))}for(const t of e){const e=t.querySelector(".id"),s=t.querySelector(".base"),i=t.querySelector(".value");if(e.validity.valid){const t=e.value;s.textContent=n.resolve(t,null),i.textContent=r.resolve(t,null)}}const o=s.querySelector(".consumed"),a=s.querySelector(".available"),c=Array.from(j.points).reduce((t,e)=>t+e[1],0),u=r.resolve("occupation_skill_points")+r.resolve("hobby_skill_points");o.textContent=c.toString(10),a.textContent=u.toString(10),s.classList.remove("full","over"),c===u?s.classList.add("full"):c>u&&s.classList.add("over")}function m(){return document.getElementById("character-input-dialog")}function v(t){const e=m();if(!e.classList.contains("open")){const s=e.querySelector(".contents-template"),i=document.importNode(s.content,!0),r=i.querySelector(".cancel"),n=i.querySelector(".ok"),o=new k.a(j);b(i,o,t),r.addEventListener("click",()=>g()),n.addEventListener("click",()=>{j=o,f(),g()}),e.appendChild(i),e.classList.add("open")}}function g(){const t=m();if(t.classList.contains("open")){const e=t.querySelector(".contents");t.removeChild(e),t.classList.remove("open")}}function y(){const t=m();return{dice:t.querySelector(".dice-input-template"),number:t.querySelector(".number-input-template"),text:t.querySelector(".text-input-template")}}function b(t,e,s){const i=t.querySelector(".name"),r=t.querySelector(".expression"),n=t.querySelector(".inputs"),o=t.querySelector(".value"),a=y();i.textContent=s.name,r.textContent=s.expression;const c=new A.c(N.c,e,!1),u={character:e,attribute:s,update(){o.textContent=c.resolve(this.attribute.id,null)}};for(const t of s.inputs)n.appendChild(x(a,Object.assign({input:t},u)));u.update()}function x(t,e){switch(e.input.type){case"dice":return _(t.dice,e);case"number":return w(t.number,e);case"text":return S(t.text,e);default:throw new Error("Invalid input type.")}}function _(t,e){const s=document.importNode(t.content,!0).querySelector(".input"),i=s.querySelector(".input-name"),r=s.querySelector(".dice-view"),n=s.querySelector(".roll-button");i.textContent=e.input.name;const o=E.a.create(e.input.count,e.input.max),a=e.character.inputs.getInput(e.attribute.id,e.input);void 0!==a&&(o.values=a);const c=new L.a;return c.register("input",o),c.select("input"),c.addListener(new M.a(r,N.b.diceImage,"dice-group","dice")),c.addListener(new class{onAttached(t){this.update(t.diceSet)}onRoll(t,e){e===L.b.Stop&&this.update(t.diceSet)}update(t){e.character.inputs.setInput(e.attribute.id,e.input,t.values),e.update()}}),n.addEventListener("click",()=>{c.roll()}),s}function w(t,e){const s=document.importNode(t.content,!0).querySelector(".input"),i=s.querySelector(".input-name"),r=s.querySelector("input");return i.textContent=e.input.name,Number.isFinite(e.input.min)&&(r.min=e.input.min.toString(10)),Number.isFinite(e.input.max)&&(r.max=e.input.max.toString(10)),Number.isFinite(e.input.step)&&(r.step=e.input.step.toString(10)),r.value=(e.character.inputs.getInput(e.attribute.id,e.input)||0).toString(10),r.addEventListener("input",()=>{r.validity.valid&&(e.character.inputs.setInput(e.attribute.id,e.input,parseFloat(r.value)),e.update())}),s}function S(t,e){const s=document.importNode(t.content,!0).querySelector(".input"),i=s.querySelector(".input-name"),r=s.querySelector("input");return i.textContent=e.input.name,r.value=e.character.inputs.getInput(e.attribute.id,e.input)||"",r.addEventListener("input",()=>{r.validity.valid&&(e.character.inputs.setInput(e.attribute.id,e.input,r.value),e.update())}),s}var E=s(6),O=s(10),k=s(2),A=s(3),L=s(4),M=s(12),N=s(0),C=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(o,a)}c((i=i.apply(t,e||[])).next())})};let q,j;e.a=function(){q=document.getElementById("character-edit"),i(),l()}}]);